<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tool B∆°m Truy·ªán S√°ng T√°c (Vi·ªát Nam)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; line-height: 1.6; background: #ecfdf5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #d1fae5; }
        h1 { color: #047857; margin-bottom: 10px; }
        p { color: #374151; }
        button { padding: 15px 30px; font-size: 1.1rem; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; margin-top: 20px; }
        button:hover { background: #059669; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #logs { margin-top: 20px; background: #064e3b; color: #6ee7b7; padding: 20px; border-radius: 8px; height: 300px; overflow-y: auto; font-family: monospace; }
        .error { color: #fca5a5; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üáªüá≥ Tool B∆°m 10 Truy·ªán S√°ng T√°c</h1>
        <p>Tool n√†y s·∫Ω t·ª± ƒë·ªông l·∫•y ng·∫´u nhi√™n c√°c <b>User ·∫£o</b> trong database ƒë·ªÉ l√†m t√°c gi·∫£.</p>
        
        <div id="status-box" style="background: #f3f4f6; padding: 10px; border-radius: 5px; font-weight: bold; color: #666;">
            ƒêang ch·ªù l·ªánh...
        </div>

        <button id="btn-seed">üöÄ B·∫ÆT ƒê·∫¶U B∆†M TRUY·ªÜN VI·ªÜT</button>

        <div id="logs">Ready.</div>
    </div>

    <script type="module">
        import { db } from './js/firebase-config.js';
        import { collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // DANH S√ÅCH 10 TRUY·ªÜN VI·ªÜT (B·ªãa ra nh∆∞ng nghe r·∫•t cu·ªën :v)
        const VIET_NOVELS = [
            {
                title: "H√†nh Tr√¨nh C·ªßa Gi√≥",
                description: "C√¢u chuy·ªán v·ªÅ m·ªôt ch√†ng trai tr·∫ª v√πng T√¢y B·∫Øc mang trong m√¨nh ∆∞·ªõc m∆° ƒë∆∞a n√¥ng s·∫£n Vi·ªát v∆∞∆°n t·∫ßm th·∫ø gi·ªõi, nh∆∞ng l·∫°i b·ªã cu·ªën v√†o cu·ªôc chi·∫øn th∆∞∆°ng tr∆∞·ªùng kh·ªëc li·ªát.",
                coverUrl: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["ƒê·ªùi Th∆∞·ªùng", "Kh·ªüi Nghi·ªáp", "Drama"],
                status: "ƒêang ra",
                length: "Truy·ªán d√†i"
            },
            {
                title: "S√†i G√≤n K√Ω S·ª±: Nh·ªØng ƒê√™m Kh√¥ng Ng·ªß",
                description: "Tuy·ªÉn t·∫≠p nh·ªØng c√¢u chuy·ªán ma m·ªã, r√πng r·ª£n di·ªÖn ra t·∫°i nh·ªØng con h·∫ªm s√¢u hun h√∫t gi·ªØa l√≤ng S√†i G√≤n hoa l·ªá.",
                coverUrl: "https://images.unsplash.com/photo-1555952517-2e8e729e0b44?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["Kinh D·ªã", "ƒê√¥ Th·ªã", "Linh D·ªã"],
                status: "ƒê√£ ho√†n th√†nh",
                length: "Truy·ªán ng·∫Øn"
            },
            {
                title: "ƒê·∫°i Vi·ªát ƒê·∫ø Qu·ªëc: Tr·ªçng Sinh 1400",
                description: "M·ªôt k·ªπ s∆∞ c∆° kh√≠ th·ªùi hi·ªán ƒë·∫°i xuy√™n kh√¥ng v·ªÅ th·ªùi nh√† H·ªì. Li·ªáu anh ta c√≥ th·ªÉ thay ƒë·ªïi l·ªãch s·ª≠, ch·ªëng l·∫°i qu√¢n Minh x√¢m l∆∞·ª£c?",
                coverUrl: "https://images.unsplash.com/photo-1618336753974-aae8e04506aa?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["L·ªãch S·ª≠", "Qu√¢n S·ª±", "Xuy√™n Kh√¥ng"],
                status: "ƒêang ra",
                length: "Truy·ªán d√†i"
            },
            {
                title: "Ch√†ng R·ªÉ Ma Gi·ªõi",
                description: "B·ªã √©p g·∫£ cho c√¥ng ch√∫a Ma Gi·ªõi ƒë·ªÉ tr·∫£ n·ª£ cho gia ƒë√¨nh, nam ch√≠nh ph√°t hi·ªán ra c√¥ v·ª£ c·ªßa m√¨nh th·ª±c ra l√† m·ªôt Otaku ch√≠nh hi·ªáu.",
                coverUrl: "https://images.unsplash.com/photo-1519074069444-1ba4fff66d16?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["Huy·ªÅn Huy·ªÖn", "H√†i H∆∞·ªõc", "L√£ng M·∫°n"],
                status: "ƒêang ra",
                length: "Truy·ªán d√†i"
            },
            {
                title: "H·ªá Th·ªëng Livestream B·∫Øt Ma",
                description: "Main nh·∫≠n ƒë∆∞·ª£c h·ªá th·ªëng b·∫Øt ma, nh∆∞ng b·∫Øt bu·ªôc ph·∫£i livestream qu√° tr√¨nh h√†nh ngh·ªÅ. C√†ng nhi·ªÅu view, ph√°p l·ª±c c√†ng m·∫°nh.",
                coverUrl: "https://images.unsplash.com/photo-1533577116850-9cc66cad8a9b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["H·ªá Th·ªëng", "Linh D·ªã", "H√†i H∆∞·ªõc"],
                status: "ƒêang ra",
                length: "Truy·ªán d√†i"
            },
            {
                title: "Thanh Xu√¢n V∆∞·ªùn Tr∆∞·ªùng C·ªßa ƒê·∫°i Ca",
                description: "ƒê·∫°i ca giang h·ªì kh√©t ti·∫øng khu Ch·ª£ L·ªõn quy·∫øt ƒë·ªãnh ho√†n l∆∞∆°ng, quay l·∫°i tr∆∞·ªùng c·∫•p 3 ƒë·ªÉ l·∫•y b·∫±ng t·ªët nghi·ªáp. T·∫°i ƒë√¢y anh g·∫∑p l·ªõp tr∆∞·ªüng 'b√† ch·∫±n'.",
                coverUrl: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["H·ªçc ƒê∆∞·ªùng", "H√†i H∆∞·ªõc", "T√¨nh C·∫£m"],
                status: "ƒê√£ ho√†n th√†nh",
                length: "Truy·ªán ng·∫Øn"
            },
            {
                title: "V√µ L√¢m Truy·ªÅn K·ª≥: T√°i Kh·ªüi",
                description: "Khi t·ª±a game huy·ªÅn tho·∫°i ƒë√≥ng c·ª≠a, top 1 server b·∫•t ng·ªù t·ªânh d·∫≠y trong ch√≠nh th·∫ø gi·ªõi game ƒë√≥, nh∆∞ng l√† 1000 nƒÉm sau.",
                coverUrl: "https://images.unsplash.com/photo-1542751371-adc38448a05e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["V√µng Du", "Ki·∫øm Hi·ªáp", "Huy·ªÅn Huy·ªÖn"],
                status: "T·∫°m ng∆∞ng",
                length: "Truy·ªán d√†i"
            },
            {
                title: "C√¥ V·ª£ T·ªïng T√†i C·ªßa T√¥i",
                description: "Motif c≈© r√≠ch: Ch√†ng v·ªá sƒ© ngh√®o v√† n·ªØ t·ªïng t√†i l·∫°nh l√πng. Nh∆∞ng c√∫ plot twist l√† ch√†ng v·ªá sƒ© th·ª±c ra l√† tr√πm x√£ h·ªôi ƒëen r·ª≠a tay g√°c ki·∫øm.",
                coverUrl: "https://images.unsplash.com/photo-1552374196-c4e7ffc6e126?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["ƒê√¥ Th·ªã", "Ng√¥n T√¨nh", "H√†nh ƒê·ªông"],
                status: "ƒêang ra",
                length: "Truy·ªán d√†i"
            },
            {
                title: "Si√™u C·∫•p ƒê·∫ßu B·∫øp T·∫°i D·ªã Gi·ªõi",
                description: "ƒêem ph·ªü, b√∫n ch·∫£, b√°nh m√¨ sang d·ªã gi·ªõi m·ªü qu√°n ƒÉn. C·∫£ Ma V∆∞∆°ng l·∫´n D≈©ng Sƒ© ƒë·ªÅu ph·∫£i x·∫øp h√†ng ch·ªù ƒÉn s√°ng.",
                coverUrl: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["Xuy√™n Kh√¥ng", "·∫®m Th·ª±c", "ƒê·ªùi Th∆∞·ªùng"],
                status: "ƒêang ra",
                length: "Truy·ªán d√†i"
            },
            {
                title: "M·∫°t Th·∫ø: Ta C√≥ M·ªôt Si√™u Th·ªã",
                description: "T·∫≠n th·∫ø zombies x·∫£y ra, trong khi ng∆∞·ªùi kh√°c tranh gi√†nh t·ª´ng mi·∫øng b√°nh m√¨, main s·ªü h·ªØu m·ªôt si√™u th·ªã c√≥ th·ªÉ ƒë·ªïi v·∫≠t ph·∫©m l·∫•y nƒÉng l∆∞·ª£ng.",
                coverUrl: "https://images.unsplash.com/photo-1542831371-29b0f74f9713?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                genres: ["M·∫°t Th·∫ø", "H·ªá Th·ªëng", "Khoa Huy·ªÖn"],
                status: "ƒêang ra",
                length: "Truy·ªán d√†i"
            }
        ];

        const btn = document.getElementById('btn-seed');
        const logs = document.getElementById('logs');
        const statusBox = document.getElementById('status-box');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.innerText = `> ${msg}`;
            if (type === 'error') div.className = 'error';
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        btn.addEventListener('click', async () => {
            btn.disabled = true;
            logs.innerHTML = '';
            log("ƒêang l·∫•y danh s√°ch User...");
            statusBox.innerText = "ƒêang qu√©t User...";

            try {
                // 1. L·∫•y danh s√°ch User ID t·ª´ Database
                const usersSnap = await getDocs(collection(db, "users"));
                
                if (usersSnap.empty) {
                    log("‚ùå L·ªói: Kh√¥ng t√¨m th·∫•y User n√†o trong DB! H√£y ch·∫°y tool seed-users.html tr∆∞·ªõc.", 'error');
                    btn.disabled = false;
                    return;
                }

                // Gom t·∫•t c·∫£ ID user v√†o m·∫£ng
                const userIds = [];
                const userNames = {}; // L∆∞u t√™n ƒë·ªÉ log cho ƒë·∫πp
                usersSnap.forEach(doc => {
                    userIds.push(doc.id);
                    userNames[doc.id] = doc.data().username;
                });

                log(`‚úÖ T√¨m th·∫•y ${userIds.length} user ti·ªÅm nƒÉng.`);
                log("B·∫Øt ƒë·∫ßu b∆°m truy·ªán...");

                let count = 0;

                for (const novel of VIET_NOVELS) {
                    // 2. Ch·ªçn random 1 user l√†m t√°c gi·∫£
                    const randomUid = userIds[Math.floor(Math.random() * userIds.length)];
                    const randomAuthorName = userNames[randomUid] || "V√¥ Danh";

                    const novelData = {
                        ...novel,
                        author: randomAuthorName, // G√°n t√™n t√°c gi·∫£ gi·∫£
                        type: "Truy·ªán S√°ng T√°c", // QUAN TR·ªåNG
                        uploaderId: randomUid,   // G√°n quy·ªÅn s·ªü h·ªØu cho user ·∫£o
                        isPending: Math.random() < 0.2, // 20% c∆° h·ªôi l√† ƒëang ch·ªù duy·ªát (ƒë·ªÉ test Admin duy·ªát b√†i)
                        isFeatured: Math.random() < 0.3, // 30% c∆° h·ªôi n·ªïi b·∫≠t
                        viewCount: Math.floor(Math.random() * 5000),
                        createdAt: new Date().toISOString()
                    };

                    await addDoc(collection(db, "novels"), novelData);
                    
                    log(`üìù ƒê√£ ƒëƒÉng: "${novel.title}" - B·ªüi: ${randomAuthorName}`);
                    count++;
                }

                log(`---------------------------------`);
                log(`üéâ XONG! ƒê√£ b∆°m ${count} truy·ªán s√°ng t√°c.`);
                statusBox.innerText = "Ho√†n t·∫•t!";

            } catch (e) {
                console.error(e);
                log(`‚ùå L·ªói nghi√™m tr·ªçng: ${e.message}`, 'error');
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>