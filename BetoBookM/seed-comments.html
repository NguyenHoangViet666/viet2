<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tool BÆ¡m BÃ¬nh Luáº­n Ngáº«u NhiÃªn</title>
    <style>
        body { font-family: sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; background: #e0f2f7; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 2px solid #06b6d4; }
        h1 { color: #06b6d4; margin-bottom: 10px; }
        button { padding: 15px 30px; font-size: 1.1rem; background: #06b6d4; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; margin-top: 20px; }
        button:hover { background: #0891b2; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #logs { margin-top: 20px; background: #155e75; color: #67e8f9; padding: 20px; border-radius: 8px; height: 300px; overflow-y: auto; font-family: monospace; }
        .error { color: #f87171; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ’¬ Tool BÆ¡m 10 BÃ¬nh Luáº­n</h1>
        <p>Tá»± Ä‘á»™ng chá»n User vÃ  Truyá»‡n ngáº«u nhiÃªn Ä‘á»ƒ Ä‘Äƒng 10 bÃ¬nh luáº­n nghá»‹ch ngá»£m.</p>
        
        <button id="btn-seed">ğŸš€ Báº®T Äáº¦U BÆ M COMMENT</button>

        <div id="logs">Ready.</div>
    </div>

    <script type="module">
        import { db } from './js/firebase-config.js';
        import { collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // Máº«u bÃ¬nh luáº­n nghá»‹ch ngá»£m
        const FUNNY_COMMENTS = [
            "ChÆ°Æ¡ng nÃ y hay quÃ¡, tÃ¡c giáº£ láº¡i lÃªn Ä‘á»“ng rá»“i! Tui xin bÃ¡i phá»¥c!",
            "HÃ³ng mÃ£i cuá»‘i cÃ¹ng cÅ©ng ra. Team hÃ³ng chÆ°Æ¡ng má»›i Ä‘iá»ƒm danh!",
            "TÃ¡c giáº£ Æ¡i, bao giá» thÃ¬ nam chÃ­nh má»›i nháº­n ra ná»¯ chÃ­nh lÃ  ai váº­y? Äá»«ng lÃ m khá»• con dÃ¢n ná»¯a!",
            "Äoáº¡n nÃ y logic cÃ³ váº» hÆ¡i bá»‹p, nhÆ°ng tui thÃ­ch! Cá»© tiáº¿p tá»¥c Ä‘i áº¡.",
            "Äá»c láº¡i láº§n thá»© N rá»“i mÃ  váº«n tháº¥y cuá»‘n, Ä‘á»‰nh cao!",
            "Xin vÃ­a khÃ´ng bá»‹ drop, tui lÃ³t dÃ©p chá» cáº£ nÄƒm rá»“i.",
            "Xin lá»—i, tui lÆ°á»›t qua Ä‘á»ƒ láº¡i má»™t dáº¥u chÃ¢n. ChÆ°Æ¡ng sau sáº½ Ä‘á»c bÃ¹.",
            "Truyá»‡n nÃ y mÃ  lÃ m phim thÃ¬ hot pháº£i biáº¿t! Ai Ä‘á»“ng Ã½ khÃ´ng?",
            "Admin/Mod Ä‘Ã¢u, ra Ä‘Ã¢y giáº£i thÃ­ch há»™ cÃ¡i plot twist cuá»‘i chÆ°Æ¡ng vá»›i!",
            "Má»›i Ä‘á»c, cho tui há»i main lÃ  ngÆ°á»i tá»‘t hay ngÆ°á»i xáº¥u váº­y má»i ngÆ°á»i? Tui hÆ¡i rá»‘i."
        ];

        const btn = document.getElementById('btn-seed');
        const logs = document.getElementById('logs');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.innerText = `> ${msg}`;
            if (type === 'error') div.className = 'error';
            if (type === 'success') div.className = 'success';
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        btn.addEventListener('click', async () => {
            btn.disabled = true;
            logs.innerHTML = '';
            log("Äang quÃ©t User & Novel IDs...");

            try {
                // 1. Láº¥y danh sÃ¡ch Users (cáº§n object full: avatar, username, role)
                const usersSnap = await getDocs(collection(db, "users"));
                const users = usersSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // 2. Láº¥y danh sÃ¡ch Novels (chá»‰ cáº§n ID)
                const novelsSnap = await getDocs(collection(db, "novels"));
                const novelIds = novelsSnap.docs.map(doc => doc.id);

                if (users.length === 0 || novelIds.length === 0) {
                    log("âŒ Lá»—i: Cáº§n Ã­t nháº¥t 1 User vÃ  1 Novel Ä‘á»ƒ Comment. HÃ£y cháº¡y seed-users.html vÃ  seed-novels.html trÆ°á»›c.", 'error');
                    btn.disabled = false;
                    return;
                }

                log(`âœ… TÃ¬m tháº¥y ${users.length} User vÃ  ${novelIds.length} Truyá»‡n.`);
                let count = 0;

                for (let i = 0; i < 10; i++) {
                    // Chá»n ngáº«u nhiÃªn User vÃ  Novel
                    const randomUser = users[Math.floor(Math.random() * users.length)];
                    const randomNovelId = novelIds[Math.floor(Math.random() * novelIds.length)];
                    const randomComment = FUNNY_COMMENTS[i % FUNNY_COMMENTS.length];
                    
                    const commentData = {
                        novelId: randomNovelId, 
                        userId: randomUser.id,
                        username: randomUser.username,
                        role: randomUser.role, 
                        userAvatar: randomUser.avatar || 'https://via.placeholder.com/150',
                        content: randomComment,
                        createdAt: new Date(Date.now() - (i * 3600000)).toISOString(), // Giáº£ láº­p thá»i gian khÃ¡c nhau
                        likedBy: [],
                        replies: []
                    };

                    await addDoc(collection(db, "comments"), commentData);
                    
                    log(`ğŸ“ [${i+1}/10] Comment tá»« ${randomUser.username} Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng.`, 'success');
                    count++;
                }

                log(`--- HOÃ€N Táº¤T! ÄÃ£ bÆ¡m ${count} bÃ¬nh luáº­n. ---`);
                log(`ğŸ‘‰ VÃ o trang Chi tiáº¿t Truyá»‡n báº¥t ká»³ Ä‘á»ƒ kiá»ƒm tra!`, 'success');

            } catch (e) {
                console.error(e);
                log(`âŒ Lá»—i nghiÃªm trá»ng: ${e.message}`, 'error');
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>